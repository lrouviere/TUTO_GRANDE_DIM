<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Statistique en grande dimension - 2&nbsp; Régression sur composantes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03-ridge-lasso.html" rel="next">
<link href="./01-intro-grande-dim.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-intro-grande-dim.html">Supervisée</a></li><li class="breadcrumb-item"><a href="./02-reg-comp.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Régression sur composantes</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistique en grande dimension</a> 
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Statistique-en-grande-dimension.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Statistique-en-grande-dimension.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Présentation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Supervisée</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro-grande-dim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Les problèmes de la grande dimension</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-reg-comp.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Régression sur composantes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-ridge-lasso.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Régressions pénalisées (ou sous contraintes)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-mod-add.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Modèle additif</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Non supervisée</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-kmeans-cah.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Rappels sur le <span class="math inline">\(k\)</span>-means et la CAH</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-dbscan-spectral.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Dbscan et clustering spectral</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Références</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table des matières</h2>
   
  <ul>
  <li><a href="#sélection-de-variables" id="toc-sélection-de-variables" class="nav-link active" data-scroll-target="#sélection-de-variables"><span class="header-section-number">2.1</span> Sélection de variables</a></li>
  <li><a href="#régression-sur-composantes-principales-méthodo" id="toc-régression-sur-composantes-principales-méthodo" class="nav-link" data-scroll-target="#régression-sur-composantes-principales-méthodo"><span class="header-section-number">2.2</span> Régression sur composantes principales (méthodo)</a></li>
  <li><a href="#régression-pls-méthodo" id="toc-régression-pls-méthodo" class="nav-link" data-scroll-target="#régression-pls-méthodo"><span class="header-section-number">2.3</span> Régression PLS : méthodo</a></li>
  <li><a href="#comparaison-pcr-vs-pls." id="toc-comparaison-pcr-vs-pls." class="nav-link" data-scroll-target="#comparaison-pcr-vs-pls."><span class="header-section-number">2.4</span> Comparaison : PCR vs PLS.</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="reg-comp" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Régression sur composantes</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<style>
div.correction {
  color: black;
  background-color: #F0F0F0;
  font-style: normal;
  /*display: none;*/
}

.corR {
  font-style: italic;
  /*display: none;*/
}

.algo{
  color: black;
  background-color: #F9C4ED;
  font-style: normal;
}

</style>
<p>Les performances des estimateurs classiques (MCO) des paramètres du modèle linéaire</p>
<p><span class="math display">\[Y=\beta_0+\beta_1X_1+\dots+\beta_dX_d+\varepsilon\]</span> peuvent se dégrader lorsque la dimension <span class="math inline">\(d\)</span> est grande ou en présence de dépendance linéaire entre les variables explicatives. Les régressions sur composantes consistent à trouver de nouvelles composantes <span class="math inline">\(Z_k,j=k,\dots,q\)</span> avec <span class="math inline">\(q\leq p\)</span> qui s’écrivent le plus souvent comme des combinaisons linéaires des <span class="math inline">\(X_j\)</span> dans l’idée de diminuer le nombre de paramètres du modèle ou la dépendance entre les covariables. Il existe plusieurs façons de construire ces composantes, dans cette partie nous proposons :</p>
<ul>
<li>la <strong>régression sous composantes principales (PCR)</strong> : il s’agit de faire simplement une ACP sur la matrice des variables explicatives ;</li>
<li>la <strong>régression partial least square (PLS)</strong> qui fait intervenir la variable cible dans la construction des composantes.</li>
</ul>
<p>Nous commençons par un bref rappel sur la sélection de variables.</p>
<section id="sélection-de-variables" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sélection-de-variables"><span class="header-section-number">2.1</span> Sélection de variables</h2>
<p>On considère le jeu de données <code>ozone.txt</code> où on cherche à expliquer la concentration maximale en ozone relevée sur une journée (variable <code>maxO3</code>) par d’autres variables essentiellement météorologiques.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ozone <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/ozone.txt"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ozone)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         maxO3   T9  T12  T15 Ne9 Ne12 Ne15     Vx9    Vx12    Vx15 maxO3v
20010601    87 15.6 18.5 18.4   4    4    8  0.6946 -1.7101 -0.6946     84
20010602    82 17.0 18.4 17.7   5    5    7 -4.3301 -4.0000 -3.0000     87
20010603    92 15.3 17.6 19.5   2    5    4  2.9544  1.8794  0.5209     82
20010604   114 16.2 19.7 22.5   1    1    0  0.9848  0.3473 -0.1736     92
20010605    94 17.4 20.5 20.4   8    8    7 -0.5000 -2.9544 -4.3301    114
20010606    80 17.7 19.8 18.3   6    6    7 -5.6382 -5.0000 -6.0000     94
          vent pluie
20010601  Nord   Sec
20010602  Nord   Sec
20010603   Est   Sec
20010604  Nord   Sec
20010605 Ouest   Sec
20010606 Ouest Pluie</code></pre>
</div>
</div>
<ol type="1">
<li><p>Ajuster un modèle linéaire avec <code>lm</code> et analyser la pertinence des variables explicatives dans le modèle.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>lin.complet <span class="ot">&lt;-</span> <span class="fu">lm</span>(maxO3<span class="sc">~</span>.,<span class="at">data=</span>ozone)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lin.complet)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = maxO3 ~ ., data = ozone)

Residuals:
    Min      1Q  Median      3Q     Max 
-51.814  -8.695  -1.020   7.891  40.046 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 16.26536   15.94398   1.020   0.3102    
T9           0.03917    1.16496   0.034   0.9732    
T12          1.97257    1.47570   1.337   0.1844    
T15          0.45031    1.18707   0.379   0.7053    
Ne9         -2.10975    0.95985  -2.198   0.0303 *  
Ne12        -0.60559    1.42634  -0.425   0.6721    
Ne15        -0.01718    1.03589  -0.017   0.9868    
Vx9          0.48261    0.98762   0.489   0.6262    
Vx12         0.51379    1.24717   0.412   0.6813    
Vx15         0.72662    0.95198   0.763   0.4471    
maxO3v       0.34438    0.06699   5.141 1.42e-06 ***
ventNord     0.53956    6.69459   0.081   0.9359    
ventOuest    5.53632    8.24792   0.671   0.5037    
ventSud      5.42028    7.16180   0.757   0.4510    
pluieSec     3.24713    3.48251   0.932   0.3534    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 14.51 on 97 degrees of freedom
Multiple R-squared:  0.7686,    Adjusted R-squared:  0.7352 
F-statistic: 23.01 on 14 and 97 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lin.complet)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: maxO3
          Df Sum Sq Mean Sq  F value    Pr(&gt;F)    
T9         1  43138   43138 205.0160 &lt; 2.2e-16 ***
T12        1  11125   11125  52.8706 9.165e-11 ***
T15        1    876     876   4.1619 0.0440614 *  
Ne9        1   3244    3244  15.4170 0.0001613 ***
Ne12       1    232     232   1.1035 0.2961089    
Ne15       1      5       5   0.0248 0.8752847    
Vx9        1   2217    2217  10.5355 0.0016079 ** 
Vx12       1      1       1   0.0049 0.9443039    
Vx15       1     67      67   0.3186 0.5737491    
maxO3v     1   6460    6460  30.6993 2.584e-07 ***
vent       3    234      78   0.3709 0.7741473    
pluie      1    183     183   0.8694 0.3534399    
Residuals 97  20410     210                       
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="corR">
<p>Il semble que quelques variables ne sont pas nécessaires dans le modèle.</p>
</div></li>
<li><p>Expliquer les sorties de la commande</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaps)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mod.sel <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(maxO3<span class="sc">~</span>.,<span class="at">data=</span>ozone,<span class="at">nvmax=</span><span class="dv">14</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.sel)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Subset selection object
Call: regsubsets.formula(maxO3 ~ ., data = ozone, nvmax = 14)
14 Variables  (and intercept)
          Forced in Forced out
T9            FALSE      FALSE
T12           FALSE      FALSE
T15           FALSE      FALSE
Ne9           FALSE      FALSE
Ne12          FALSE      FALSE
Ne15          FALSE      FALSE
Vx9           FALSE      FALSE
Vx12          FALSE      FALSE
Vx15          FALSE      FALSE
maxO3v        FALSE      FALSE
ventNord      FALSE      FALSE
ventOuest     FALSE      FALSE
ventSud       FALSE      FALSE
pluieSec      FALSE      FALSE
1 subsets of each size up to 14
Selection Algorithm: exhaustive
          T9  T12 T15 Ne9 Ne12 Ne15 Vx9 Vx12 Vx15 maxO3v ventNord ventOuest
1  ( 1 )  " " "*" " " " " " "  " "  " " " "  " "  " "    " "      " "      
2  ( 1 )  " " "*" " " " " " "  " "  " " " "  " "  "*"    " "      " "      
3  ( 1 )  " " "*" " " "*" " "  " "  " " " "  " "  "*"    " "      " "      
4  ( 1 )  " " "*" " " "*" " "  " "  "*" " "  " "  "*"    " "      " "      
5  ( 1 )  " " "*" " " "*" " "  " "  "*" " "  " "  "*"    " "      " "      
6  ( 1 )  " " "*" " " "*" " "  " "  "*" " "  "*"  "*"    " "      " "      
7  ( 1 )  " " "*" " " "*" " "  " "  "*" " "  "*"  "*"    "*"      " "      
8  ( 1 )  " " "*" " " "*" " "  " "  "*" " "  "*"  "*"    " "      "*"      
9  ( 1 )  " " "*" " " "*" "*"  " "  "*" " "  "*"  "*"    " "      "*"      
10  ( 1 ) " " "*" "*" "*" "*"  " "  "*" " "  "*"  "*"    " "      "*"      
11  ( 1 ) " " "*" "*" "*" "*"  " "  "*" "*"  "*"  "*"    " "      "*"      
12  ( 1 ) " " "*" "*" "*" "*"  " "  "*" "*"  "*"  "*"    "*"      "*"      
13  ( 1 ) "*" "*" "*" "*" "*"  " "  "*" "*"  "*"  "*"    "*"      "*"      
14  ( 1 ) "*" "*" "*" "*" "*"  "*"  "*" "*"  "*"  "*"    "*"      "*"      
          ventSud pluieSec
1  ( 1 )  " "     " "     
2  ( 1 )  " "     " "     
3  ( 1 )  " "     " "     
4  ( 1 )  " "     " "     
5  ( 1 )  " "     "*"     
6  ( 1 )  " "     "*"     
7  ( 1 )  " "     "*"     
8  ( 1 )  "*"     "*"     
9  ( 1 )  "*"     "*"     
10  ( 1 ) "*"     "*"     
11  ( 1 ) "*"     "*"     
12  ( 1 ) "*"     "*"     
13  ( 1 ) "*"     "*"     
14  ( 1 ) "*"     "*"     </code></pre>
</div>
</div>
<div class="corR">
<p>On obtient une table avec des étoiles qui permettent de visualiser les meilleurs modèles à <span class="math inline">\(1,2,\dots,8\)</span> variables au sens du <span class="math inline">\(R^2\)</span>.</p>
</div></li>
<li><p>Sélectionner le meilleur modèle au sens du <span class="math inline">\(R^2\)</span>. Que remarquez-vous ?</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod.sel,<span class="at">scale=</span><span class="st">"r2"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-reg-comp_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="corR">
<p>Le meilleur modèle est le modèle complet. C’est logique puisque le <span class="math inline">\(R^2\)</span> va toujours privilégier le modèle le plus complexe, c’est un critère <code>d'ajustement</code>.</p>
</div></li>
<li><p>Faire de même pour le <span class="math inline">\(C_p\)</span> et le <span class="math inline">\(BIC\)</span>. Que remarquez-vous pour les variables explicatives qualitatives ?</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod.sel,<span class="at">scale=</span><span class="st">"bic"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-reg-comp_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod.sel,<span class="at">scale=</span><span class="st">"Cp"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-reg-comp_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="corR">
<p>Ces critères choisissent ici le même modèle, avec 4 variables. On remarque que les variables qualitatives ne sont <code>pas réellement traitées comme des variables</code> : une modalité est égale à une variable. Par conséquent, cette procédure ne permet pas vraiment de sélectionner des variables qualitatives.</p>
</div></li>
<li><p>Comparer cette méthode avec des modèles sélectionnées par la fonction <code>step</code> ou la fonction <code>bestglm</code> du package <code>bestglm</code>.<br>
</p>
<div class="corR">
<ul>
<li><p>La fonction <code>step</code> permet de faire de la sélection <strong>pas à pas</strong>. Par exemple, pour une procédure <code>descendante</code> avec le critère <span class="math inline">\(AIC\)</span> on utilisera :</p>
<pre data-rteacher="correct"><code>mod.step &lt;- step(lin.complet,direction="backward",trace=0)
mod.step</code></pre>
<p>La fonction <code>bestglm</code> permet quant à elle de faire des sélections exhaustive ou pas à pas, on peut l’utiliser pour tous les <strong>glm</strong>. Attention les variables qualitatives doivent être des facteurs et la variable à expliquer doit être positionnée en dernière colonne pour cette fonction.</p>
<div class="cell" data-teacher="true" data-hash="02-reg-comp_cache/html/chunk-bestglm_ae0b1476729398bc47d9f5b8464efb5d">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ozone1 <span class="ot">&lt;-</span> ozone <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">vent=</span><span class="fu">as.factor</span>(vent),<span class="at">pluie=</span><span class="fu">as.factor</span>(pluie)) <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>maxO3,<span class="fu">everything</span>())</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bestglm)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>model.bglm <span class="ot">&lt;-</span> <span class="fu">bestglm</span>(ozone1,<span class="at">IC=</span><span class="st">"BIC"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>model.bglm<span class="sc">$</span>BestModel <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ ., data = data.frame(Xy[, c(bestset[-1], FALSE), 
    drop = FALSE], y = y))

Residuals:
    Min      1Q  Median      3Q     Max 
-52.396  -8.377  -1.086   7.951  40.933 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 12.63131   11.00088   1.148 0.253443    
T12          2.76409    0.47450   5.825 6.07e-08 ***
Ne9         -2.51540    0.67585  -3.722 0.000317 ***
Vx9          1.29286    0.60218   2.147 0.034055 *  
maxO3v       0.35483    0.05789   6.130 1.50e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 14 on 107 degrees of freedom
Multiple R-squared:  0.7622,    Adjusted R-squared:  0.7533 
F-statistic: 85.75 on 4 and 107 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div></li>
</ul>
</div></li>
</ol>
</section>
<section id="régression-sur-composantes-principales-méthodo" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="régression-sur-composantes-principales-méthodo"><span class="header-section-number">2.2</span> Régression sur composantes principales (méthodo)</h2>
<p>L’algorithme <strong>PCP</strong> est une méthode de réduction de dimension, elle consiste à faire un modèle linéaire <strong>MCO</strong> sur les premiers axes de l’<strong>ACP</strong>. On désigne par</p>
<ul>
<li><span class="math inline">\(\mathbb X\)</span> la matrice qui contient les valeurs des variables explicatives que l’on suppose centrée réduite.</li>
<li><span class="math inline">\(Z_1,\dots,Z_p\)</span> les axes de l’ACP qui s’écrivent comme des combinaisons linéaires des variables explicatives : <span class="math inline">\(Z_j=w_j^t X\)</span>.</li>
</ul>
<p>L’algorithme <strong>PCR</strong> consiste à choisir un nombre de composantes <span class="math inline">\(m\)</span> et à faire une régression MCO sur les <span class="math inline">\(m\)</span> premiers axes de l’ACP : <span class="math display">\[Y=\alpha_0+\alpha_1 Z_1+\dots+\alpha_mZ_m+\varepsilon.\]</span></p>
<p>Si on désigne par</p>
<ul>
<li><span class="math inline">\(x\in\mathbb R^d\)</span> une nouvelle observation que l’on a centrée réduite également;</li>
<li><span class="math inline">\(z_1,\dots,z_M\)</span> les coordonnées de <span class="math inline">\(x\)</span> dans la base définie par les <span class="math inline">\(m\)</span> premiers axes de l’ACP (<span class="math inline">\(z_j=w_j^tx\)</span>)</li>
</ul>
<p>l’algorithme <strong>PCR</strong> reverra la prévision <span class="math display">\[\widehat m_{\text{PCR}}(x)=\widehat \alpha_0+\widehat \alpha_1 z_1+\dots+\widehat \alpha_mz_m.\]</span> Cette prévision peut s’écrire également comme une combinaison linéaire des variables explicatives (centrées réduites ou non) : <span class="math display">\[\widehat m_{\text{PCR}}(x)=\widehat \gamma_0+\widehat \gamma_1 \tilde x_1+\dots+\widehat \gamma_p \tilde x_p=\widehat \beta_0+\widehat \beta_1 x_1+\dots+\widehat \beta_p x_p,\]</span> <span class="math inline">\(\tilde x_j\)</span> désignant l’observation brute (non centrée réduite).</p>
<p>L’exercice suivant revient sur cet algorithme et notamment sur le lien entre ces différents paramètres.</p>
<div id="exr-exo-methodo-pcr" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercice 2.1 (Régression PCR avec R) </strong></span>On considère le jeu de données <strong>Hitters</strong> dans lequel on souhaite expliquer la variable <strong>Salary</strong> par les autres variables du jeu de données. Pour simplifier le problème, on supprime les individus qui possèdent des données manquantes (il ne faut pas faire ça normalement !).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Hitters <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(Hitters)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><p>Parmi les variables explicatives, certaines sont qualitatives. Expliquer comment, à l’aide de la fonction <strong>model.matrix</strong> on peut utiliser ces variables dans un modèle linéaire. On appellera <strong>X</strong> la matrice des variables explicatives construites avec cette variable.</p>
<div class="corR">
<p>Comme pour le modèle linéaire, on utilise des contraintes identifiantes. Cela revient à prendre une modalité de référence et à coder les autres modalités par 0-1.</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(Salary<span class="sc">~</span>.,<span class="at">data=</span>Hitters)[,<span class="sc">-</span><span class="dv">1</span>]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Calculer la matrice <strong>Xcr</strong> qui correspond à la matrice <strong>X</strong> centrée réduite. On pourra utiliser la fonction <code>scale</code>.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Xcr <span class="ot">&lt;-</span> <span class="fu">scale</span>(X)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>Xbar  <span class="ot">&lt;-</span> <span class="fu">apply</span>(X,<span class="dv">2</span>,mean)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>stdX <span class="ot">&lt;-</span> <span class="fu">apply</span>(X,<span class="dv">2</span>,sd)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>A l’aide de la fonction <code>PCA</code> du package <strong>FactoMineR</strong>, effectuer l’ACP du tableau <strong>Xcr</strong> avec l’option <code>scale.unit=FALSE</code>.</p>
<div class="corR">
<p>On utilise ici <code>scale.unit=FALSE</code> car les données sont déjà centrées-réduites. Ça nous permet de contrôler cette étape.</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>acp.hit <span class="ot">&lt;-</span> <span class="fu">PCA</span>(Xcr,<span class="at">scale.unit=</span><span class="cn">FALSE</span>,<span class="at">graph=</span><span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-reg-comp_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="02-reg-comp_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
</div></li>
<li><p>Récupérer les coordonnées des individus sur les 5 premiers axes de l’ACP (variables <span class="math inline">\(Z\)</span> dans le cours).</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>CC <span class="ot">&lt;-</span> acp.hit<span class="sc">$</span>ind<span class="sc">$</span>coord</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Effectuer la régression linéaire sur les 5 premières composantes principales et calculer les estimateurs des MCO (<span class="math inline">\(\widehat\alpha_k,k=1,\dots,5\)</span> dans le cours).</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>donnees <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(CC,<span class="at">Salary=</span>Hitters<span class="sc">$</span>Salary)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(Salary<span class="sc">~</span>.,<span class="at">data=</span>donnees)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>alpha</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       Dim.1       Dim.2       Dim.3       Dim.4       Dim.5 
  535.92588   106.57139    21.64469    24.34057    37.05637   -58.52540 </code></pre>
</div>
</div>
<div class="corR">
<p><strong>Remarque</strong> :</p>
<ul>
<li>On obtient ici les estimateurs des <span class="math inline">\(\alpha,j=1,\dots,5\)</span>.<br>
</li>
<li>on peut aussi tout faire “à la main” (sans utiliser <strong>PCA</strong>)</li>
</ul>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>acp.main <span class="ot">&lt;-</span> <span class="fu">eigen</span>(<span class="fu">t</span>(Xcr)<span class="sc">%*%</span>Xcr)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> acp.main<span class="sc">$</span>vectors</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>CC <span class="ot">&lt;-</span> Xcr<span class="sc">%*%</span>(<span class="sc">-</span>U[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(CC,<span class="at">Salary=</span>Hitters<span class="sc">$</span>Salary)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>modS <span class="ot">&lt;-</span> <span class="fu">lm</span>(Salary<span class="sc">~</span>.,<span class="at">data=</span>D)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>coefS <span class="ot">&lt;-</span> modS<span class="sc">$</span>coefficients</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(modS)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         `1`         `2`         `3`         `4`         `5` 
  535.92588  -106.57139    21.64469    24.34057    37.05637    58.52540 </code></pre>
</div>
</div></li>
<li><p>En déduire les estimateurs dans l’espace des données initiales pour les données centrées réduites, puis pour les données brutes. On pourra récupérer les vecteurs propres de l’ACP (<span class="math inline">\(w_k\)</span> dans le cours) dans la sortie <strong>svd</strong> de la fonction <strong>PCA</strong>.</p>
<div class="corR">
<ul>
<li><p>Pour les données centrées-réduites, les coefficients s’obtiennent avec les formules vues en cours<br>
</p>
<p><span class="math display">\[\widehat\beta_0=\bar{\mathbb Y}\quad\text{et}\quad \widehat\beta_j=\sum_{k=1}^m\widehat\alpha_kw_{kj}.\]</span></p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>    W <span class="ot">&lt;-</span> acp.hit<span class="sc">$</span>svd<span class="sc">$</span>V</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    V <span class="ot">&lt;-</span> <span class="fu">t</span>(W)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    beta0.cr <span class="ot">&lt;-</span> <span class="fu">mean</span>(Hitters<span class="sc">$</span>Salary)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    beta.cr <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(alpha[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>])<span class="sc">%*%</span>V</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    beta.cr</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]     [,2]    [,3]     [,4]     [,5]     [,6]     [,7]     [,8]
[1,] 28.76604 30.44702 25.8445 33.00088 33.81997 35.08779 22.35103 29.01477
         [,9]    [,10]    [,11]    [,12]    [,13]  [,14]     [,15]    [,16]
[1,] 29.78584 30.00201 32.06912 31.11231 31.48735 19.439 -63.20387 17.36044
         [,17]     [,18]    [,19]
[1,] -5.523264 -6.044002 21.74267</code></pre>
</div>
</div></li>
<li><p>Pour les données brutes, on utilise les formules :</p>
<p><span class="math display">\[\widehat\gamma_0=\widehat\beta_0-\sum_{j=1}^p\widehat\beta_j\mu_j\quad\text{et}\quad\widehat\gamma_j=\frac{\widehat\beta_j}{\sigma_j}.\]</span></p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>    gamma0 <span class="ot">&lt;-</span> beta0.cr<span class="sc">-</span><span class="fu">sum</span>(beta.cr<span class="sc">*</span>Xbar<span class="sc">/</span>stdX)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    gamma <span class="ot">&lt;-</span> beta.cr<span class="sc">/</span>stdX</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    gamma0</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -58.32022</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>    gamma</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]      [,2]    [,3]     [,4]     [,5]     [,6]     [,7]       [,8]
[1,] 0.1952793 0.6747214 2.95126 1.292134 1.306662 1.615605 4.662667 0.01268914
           [,9]     [,10]      [,11]      [,12]    [,13]    [,14]   [,15]
[1,] 0.04595165 0.3649987 0.09682748 0.09621344 0.119245 38.86728 -126.19
          [,16]       [,17]      [,18]    [,19]
[1,] 0.06201606 -0.03807032 -0.9148466 43.51629</code></pre>
</div>
</div></li>
</ul>
</div></li>
<li><p>Retrouver les estimateurs dans l’espace des données initiales pour les données centrées réduites à l’aide de la fonction <code>pcr</code> du package <strong>pls</strong>.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pls)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>pcr.fit <span class="ot">&lt;-</span> <span class="fu">pcr</span>(Salary<span class="sc">~</span>.,<span class="at">data=</span>Hitters,<span class="at">scale=</span><span class="cn">TRUE</span>,<span class="at">ncomp=</span><span class="dv">19</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(pcr.fit,<span class="at">ncomp=</span><span class="dv">5</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 5 comps

               Salary
AtBat       28.766042
Hits        30.447021
HmRun       25.844498
Runs        33.000876
RBI         33.819966
Walks       35.087794
Years       22.351033
CAtBat      29.014768
CHits       29.785842
CHmRun      30.002014
CRuns       32.069124
CRBI        31.112315
CWalks      31.487349
LeagueN     19.438996
DivisionW  -63.203872
PutOuts     17.360440
Assists     -5.523264
Errors      -6.044002
NewLeagueN  21.742668</code></pre>
</div>
</div>
<div class="corR">
<p>On remarque que la fonction <strong>PCR</strong> renvoie les coefficients par rapport aux variables initiales centrées réduites. Cela fait du sens car il est dans ce cas possible de comparer les valeurs des estimateurs pour tenter d’interpréter le modèle. C’est beaucoup plus difficile à faire avec les coefficients des axes de l’ACP ou des variables intiales. Il est également important de noter que, contrairement aux estimateurs MCO du modèle linéaire Gaussien, on n’a pas d’information précise sur la loi des estimateurs, il n’est donc pas possible (ou pas facile) de faire des tests ou de calculer des intervalles de confiance.</p>
</div></li>
<li><p>On considère les individus suivants</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df.new <span class="ot">&lt;-</span> Hitters[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">100</span>,<span class="dv">80</span>),]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calculer de 3 façons différentes les valeurs de salaire prédites par la régression sur 5 composantes principales.</p>
<div class="corR">
<ul>
<li><p>Approche classique : on utilise <code>predict.pcr</code> :</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(pcr.fit,<span class="at">newdata=</span>df.new,<span class="at">ncomp=</span><span class="dv">5</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 5 comps

                Salary
-Alan Ashby   495.0068
-Hubie Brooks 577.9581
-George Bell  822.0296</code></pre>
</div>
</div></li>
<li><p>On considère les valeurs centrées réduites et on utilise : <span class="math display">\[\widehat m_{\text{PCR}}(x)=\widehat\beta_0+\widehat\beta_1x_1+\dots+\widehat\beta_px_p.\]</span></p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">coefficients</span>(pcr.fit,<span class="at">ncomp=</span><span class="dv">5</span>))) <span class="sc">%*%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t</span>(<span class="fu">as.matrix</span>(Xcr[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">100</span>,<span class="dv">80</span>),]))<span class="sc">+</span><span class="fu">mean</span>(Hitters<span class="sc">$</span>Salary)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     -Alan Ashby -Hubie Brooks -George Bell
[1,]    495.0068      577.9581     822.0296</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ou</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    beta0.cr<span class="sc">+</span>beta.cr<span class="sc">%*%</span><span class="fu">t</span>(<span class="fu">as.matrix</span>(Xcr[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">100</span>,<span class="dv">80</span>),]))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     -Alan Ashby -Hubie Brooks -George Bell
[1,]    495.0068      577.9581     822.0296</code></pre>
</div>
</div></li>
<li><p>On considère les données brutes et on utilise : <span class="math display">\[\widehat m_{\text{PCR}}(x)=\widehat\gamma+\widehat\gamma_1\tilde x_1+\dots+\widehat\gamma_p\tilde x_p.\]</span></p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>    gamma0<span class="sc">+</span>gamma <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(X[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">100</span>,<span class="dv">80</span>),]))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     -Alan Ashby -Hubie Brooks -George Bell
[1,]    495.0068      577.9581     822.0296</code></pre>
</div>
</div></li>
</ul>
</div></li>
</ol>
</div>
<div id="exr-exo-cal-compPCR" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercice 2.2 (Composantes PCR) </strong></span>On rappelle que les poids <span class="math inline">\(w_k\)</span> des composantes principales s’obtiennent en résolvant le problème :</p>
<p><span class="math display">\[\max_{w\in\mathbb R^d}\mathbf V(\mathbb Xw)\]</span> <span class="math display">\[\text{sous les contraintes }\|w\|=1,w^t\mathbb X^t\mathbb X w_\ell=0, \ell=1,\dots,k-1.\]</span></p>
<ol type="1">
<li><p>Montrer <span class="math inline">\(w_1\)</span> est un vecteur propre associé à la plus grande valeur propre de <span class="math inline">\(\mathbb X^t\mathbb X\)</span>.</p>
<div class="correction">
<p>On écrit le Lagrangien <span class="math display">\[L(w,\lambda)=w^t\mathbb X^t\mathbb Xw-\lambda(w^tw-1).\]</span> et on le dérive par rapport à <span class="math inline">\(w\)</span> : <span class="math display">\[\frac{\partial L}{\partial w}(w,\lambda)=2\mathbb X^t\mathbb Xw-2\lambda w.\]</span> En annulant cette dérivée, on déduit que <span class="math inline">\(w_1\)</span> est un vecteur propre de <span class="math inline">\(\mathbb X^t\mathbb X\)</span>. De plus, si <span class="math inline">\(w\)</span> est vecteur propre unitaire de <span class="math inline">\(\mathbb X^t\mathbb X\)</span> associé à la valeur propre <span class="math inline">\(\lambda\)</span> on a <span class="math inline">\(\mathbf V(\mathbb Xw)=\lambda\)</span>. On déduit que <span class="math inline">\(w_1\)</span> est un vecteur propre associé à la plus grande valeur propre de <span class="math inline">\(\mathbb X^t\mathbb X\)</span>.</p>
</div></li>
<li><p>Calculer <span class="math inline">\(w_2\)</span>.</p>
<div class="correction">
<p>On écrit le Lagrangien <span class="math display">\[L(w,\lambda,\mu)=w^t\mathbb X^t\mathbb Xw-\lambda(w^tw-1)-\mu w^t\mathbb X^t\mathbb Xw_1\]</span> et on calcule les dérivées partielles : <span class="math display">\[\frac{\partial L}{\partial w}(w,\lambda,\mu)=2\mathbb X^t\mathbb Xw-2\lambda w-\mu\mathbb X^t\mathbb Xw_1.\]</span> <span class="math display">\[\frac{\partial L}{\partial \lambda}(w,\lambda,\mu)=w^tw-1\quad\text{et}\quad\frac{\partial L}{\partial \mu}(w,\lambda,\mu)=-w^t\mathbb X^t\mathbb Xw_1.\]</span> En multipliant la première dérivée partielle par <span class="math inline">\(w_1^t\)</span> et en utilisant le fait que <span class="math inline">\(W_1\)</span> est un vecteur propre de <span class="math inline">\(\mathbb X^t\mathbb X\)</span>, on déduit que <span class="math inline">\(\mu=0\)</span>. Par conséquent, <span class="math inline">\(w_2\)</span> est un vecteur propre associé à la deuxième plus grande valeur propre de <span class="math inline">\(\mathbb X^t\mathbb X\)</span>.</p>
</div></li>
</ol>
</div>
</section>
<section id="régression-pls-méthodo" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="régression-pls-méthodo"><span class="header-section-number">2.3</span> Régression PLS : méthodo</h2>
<p>La régression <strong>PLS</strong> propose de construire également de nouvelles composantes comme des combinaisons linéaires des variables explicatives. Comme pour l’algorithme <strong>PCR</strong>, les composantes sont calculées les unes après les autres et orthogonales entre elles. La principale différence et qu’on ne cherche pas les composantes qui maximisent la variabilités des observations projetées, mais les composantes qui maximisent la colinéarité avec la cible. L’algorithme est expliqué dans l’exercice suivant.</p>
<div id="exr-exo-calc-comp-pls" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercice 2.3 (Calcul des composantes PLS) </strong></span>On reprend les notations du cours : <span class="math inline">\(\mathbb Y\)</span> désigne le vecteur de la variable à expliquer et <span class="math inline">\(\mathbb X\)</span> la matrice qui contient les observations des variables explicatives. On la suppose toujours centrée réduite.</p>
<ol type="1">
<li><p>On pose <span class="math inline">\(\mathbb Y^{(1)}=\mathbb Y\)</span> et <span class="math inline">\(\mathbb X^{(1)}=\mathbb X\)</span>. On cherche <span class="math inline">\(Z_1=w_1^tX^{(1)}\)</span> qui maximise <span class="math display">\[\langle \mathbb X^{(1)}w_1,\mathbb Y^{(1)}\rangle\quad\text{sous la contrainte}\quad\|w\|^2=1.\]</span> Cela revient à cherche la combinaison linéaire des colonnes de <span class="math inline">\(\mathbb X^{(1)}\)</span> la plus corrélée à <span class="math inline">\(\mathbb Y^{(1)}\)</span>. Calculer cette première composante.</p>
<div class="correction">
<p>On écrit le lagrangien <span class="math display">\[L(x,\lambda)={\mathbb Y^{(1)}}^t\mathbb X^{(1)}w_1-\frac{1}{2}\lambda(\|w_1\|^2-1)\]</span> En dérivant par rapport à <span class="math inline">\(w\)</span> et <span class="math inline">\(\lambda\)</span> on obtient les équations <span class="math display">\[\left\{
\begin{array}{l}
{\mathbb X^{(1)}}^t\mathbb Y^{(1)}-\lambda w_1=0 \\
\|w_1\|^2=1
\end{array}\right.\]</span> La solution est donnée par <span class="math display">\[w_1=\frac{{\mathbb X^{(1)}}^t\mathbb Y^{(1)}}{{\|\mathbb X^{(1)}}^t\mathbb Y^{(1)}\|}.\]</span></p>
</div></li>
<li><p>On pose <span class="math inline">\(Z_1=w_1^tX^{(1)}\)</span> et <span class="math inline">\(\mathbb Z_1=\mathbb X^{(1)}w_1\)</span>. On considère le modèle de régression linéaire <span class="math display">\[Y^{(1)}=\alpha_0+\alpha_1Z_1+\varepsilon.\]</span> Exprimer les estimateurs MCO de <span class="math inline">\(\alpha=(\alpha_0,\alpha_1)\)</span> en fonction de <span class="math inline">\(\mathbb Z^{(1)}\)</span> et <span class="math inline">\(\mathbb Y^{(1)}\)</span>.</p>
<div class="correction">
<p>On déduit <span class="math display">\[\widehat \alpha_0=\bar{\mathbb Y}^{(1)}-\widehat \alpha_1\bar{\mathbb Z}_1=\bar{\mathbb Y}^{(1)}\]</span> car <span class="math inline">\(\bar{\mathbb Z}_1=0\)</span> puisque <span class="math inline">\(\mathbb X^{(1)}\)</span> est centrée. Le second estimateur s’obtient par <span class="math display">\[\widehat \alpha_1=\frac{\langle \mathbb Z_1,\mathbb Y^{(1)}\rangle}{\langle \mathbb Z_1,\mathbb Z_1\rangle}.\]</span></p>
</div></li>
<li><p>On passe maintenant à la deuxième composante. On cherche à expliquer la partie résiduelle <span class="math display">\[\mathbb Y^{(2)}=P_{Z_1^\perp}(\mathbb Y^{(1)})=\widehat\varepsilon_1=\mathbb Y^{(1)}-\widehat{\mathbb Y}^{(1)}\]</span> par la “meilleure” combinaison linéaire orthogonale à <span class="math inline">\(Z_1\)</span>. On orthogonalise chaque <span class="math inline">\(\tilde{\mathbb X}_j^{(1)}\)</span> par rapport à <span class="math inline">\(\mathbb Z_1\)</span> : <span class="math display">\[{\mathbb X}_j^{(2)}=P_{\mathbb Z_1^\perp}({\mathbb X}_j^{(1)})=(\text{Id}-P_{\mathbb Z_1})({\mathbb X}_j^{(1)})={\mathbb X}_j^{(1)}-\frac{\langle \mathbb Z_1,{\mathbb X}_j^{(1)}\rangle}{\langle \mathbb Z_1,\mathbb Z_1\rangle}\mathbb Z_1.\]</span> et on déduit <span class="math inline">\(w_2\)</span> comme <span class="math inline">\(w_1\)</span> : <span class="math inline">\(w_2=\tilde{\mathbb X}^{(2)'}\mathbb Y^{(2)}\)</span>. On considère ensuite le modèle <span class="math inline">\(Y^{(2)}=\alpha_2Z_2+\varepsilon\)</span>. Exprimer l’estimateur des MCO de <span class="math inline">\(\alpha_2\)</span> en fonction de <span class="math inline">\(\mathbb Z_2=\mathbb X^{(2)}w_2\)</span> et <span class="math inline">\(\mathbb Y\)</span>.</p>
<div class="correction">
<p>On a <span class="math display">\[\widehat\alpha_2=\frac{\langle \mathbb Z_2,\mathbb Y^{(2)}\rangle}{\langle \mathbb Z_2,\mathbb Z_2\rangle}=\frac{\langle \mathbb Z_2,\mathbb Y-\widehat{\mathbb Y}^{(1)}\rangle}{\langle \mathbb Z_2,\mathbb Z_2\rangle}=\frac{\langle \mathbb Z_2,\mathbb Y\rangle}{\langle \mathbb Z_2,\mathbb Z_2\rangle}\]</span> car <span class="math inline">\(\widehat{\mathbb Y}^{(1)}=\widehat \alpha_0+\widehat \alpha_1\mathbb Z_1\)</span> est orthogonal à <span class="math inline">\(\mathbb Z_2\)</span>.</p>
</div></li>
</ol>
</div>
<div id="exr-exo-methodo-pls" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercice 2.4 (Régression PLS sur R) </strong></span>On considère les mêmes données que précédemment.</p>
<ol type="1">
<li><p>A l’aide du vecteur <span class="math inline">\(\mathbb Y\)</span> (<em>Salary</em>) et de la matrice des <span class="math inline">\(\mathbb X\)</span> centrées réduites calculées dans l’<a href="#exr-exo-methodo-pcr">Exercice&nbsp;<span>2.1</span></a>, calculer la première composante <strong>PLS</strong> <span class="math inline">\(\mathbb Z_1\)</span>.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(Hitters<span class="sc">$</span>Salary)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>w1 <span class="ot">&lt;-</span> <span class="fu">t</span>(Xcr)<span class="sc">%*%</span>Y</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>w1</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  [,1]
AtBat       46659.1995
Hits        51848.3247
HmRun       40543.5500
Runs        49624.3823
RBI         53122.7240
Walks       52462.0450
Years       47354.8899
CAtBat      62185.5603
CHits       64877.3193
CHmRun      62043.1671
CRuns       66504.6198
CRBI        67011.4288
CWalks      57893.5821
LeagueN     -1688.0134
DivisionW  -22753.8726
PutOuts     35514.7030
Assists      3006.3756
Errors       -638.3256
NewLeagueN   -335.0136</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Z1 <span class="ot">&lt;-</span> Xcr<span class="sc">%*%</span>w1</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>En déduire le coefficient associé à cette première composante en considérant le modèle <span class="math display">\[Y=\alpha_1 Z_1+\varepsilon.\]</span></p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z1,Y)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y<span class="sc">~</span>Z1<span class="dv">-1</span>,<span class="at">data=</span>df)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>alpha1 <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod1)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>alpha1</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Z1 
0.0005367014 </code></pre>
</div>
</div></li>
<li><p>En déduire les coefficients en fonction des variables initiales (centrées réduites) de la régression PLS à une composante <span class="math display">\[Y=\beta_0+\beta_1X_1+\dots+\beta_pX_p+\varepsilon.\]</span></p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>alpha1<span class="sc">*</span>w1</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  [,1]
AtBat       25.0420570
Hits        27.8270677
HmRun       21.7597795
Runs        26.6334747
RBI         28.5110396
Walks       28.1564522
Years       25.4154350
CAtBat      33.3750764
CHits       34.8197471
CHmRun      33.2986538
CRuns       35.6931216
CRBI        35.9651267
CWalks      31.0715657
LeagueN     -0.9059591
DivisionW  -12.2120349
PutOuts     19.0607903
Assists      1.6135259
Errors      -0.3425902
NewLeagueN  -0.1798022</code></pre>
</div>
</div></li>
<li><p>Retrouver ces coefficients en utilisant la fonction <code>plsr</code>.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>pls.fit <span class="ot">&lt;-</span> <span class="fu">plsr</span>(Salary<span class="sc">~</span>.,<span class="at">data=</span>Hitters,<span class="at">scale=</span><span class="cn">TRUE</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(pls.fit,<span class="at">ncomp =</span> <span class="dv">1</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1 comps

                Salary
AtBat       25.0420570
Hits        27.8270677
HmRun       21.7597795
Runs        26.6334747
RBI         28.5110396
Walks       28.1564522
Years       25.4154350
CAtBat      33.3750764
CHits       34.8197471
CHmRun      33.2986538
CRuns       35.6931216
CRBI        35.9651267
CWalks      31.0715657
LeagueN     -0.9059591
DivisionW  -12.2120349
PutOuts     19.0607903
Assists      1.6135259
Errors      -0.3425902
NewLeagueN  -0.1798022</code></pre>
</div>
</div></li>
</ol>
</div>
</section>
<section id="comparaison-pcr-vs-pls." class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="comparaison-pcr-vs-pls."><span class="header-section-number">2.4</span> Comparaison : PCR vs PLS.</h2>
<ol type="1">
<li><p>Séparer le jeu de données (<code>Hitters</code> toujours) en un échantillon d’apprentissage de taille 200 et un échantillon test de taille 63.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>perm <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(Hitters))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>dapp <span class="ot">&lt;-</span> Hitters[perm[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>],]</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>dtest <span class="ot">&lt;-</span> Hitters[perm[<span class="dv">201</span><span class="sc">:</span><span class="fu">nrow</span>(Hitters)],]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Avec les données d’apprentissage uniquement construire les régressions PCR et PLS. On choisira les nombres de composantes par validation croisée.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>choix.pcr <span class="ot">&lt;-</span> <span class="fu">pcr</span>(Salary<span class="sc">~</span>.,<span class="at">data=</span>dapp,<span class="at">validation=</span><span class="st">"CV"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>ncomp.pcr <span class="ot">&lt;-</span> <span class="fu">which.min</span>(choix.pcr<span class="sc">$</span>validation<span class="sc">$</span>PRESS)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>ncomp.pcr</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>choix.pls <span class="ot">&lt;-</span> <span class="fu">plsr</span>(Salary<span class="sc">~</span>.,<span class="at">data=</span>dapp,<span class="at">validation=</span><span class="st">"CV"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>ncomp.pls <span class="ot">&lt;-</span> <span class="fu">which.min</span>(choix.pls<span class="sc">$</span>validation<span class="sc">$</span>PRESS)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>ncomp.pls</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div></li>
<li><p>Comparer les deux méthodes en utilisant l’échantillon de validation. On pourra également utiliser un modèle linéaire classique.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mod.lin <span class="ot">&lt;-</span> <span class="fu">lm</span>(Salary<span class="sc">~</span>.,<span class="at">data=</span>dapp)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>prev <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">lin=</span><span class="fu">predict</span>(mod.lin,<span class="at">newdata=</span>dtest),</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pcr=</span><span class="fu">as.vector</span>(<span class="fu">predict</span>(choix.pcr,<span class="at">newdata =</span> dtest,<span class="at">ncomp=</span>ncomp.pcr)),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pls=</span><span class="fu">as.vector</span>(<span class="fu">predict</span>(choix.pls,<span class="at">newdata =</span> dtest,<span class="at">ncomp=</span>ncomp.pls)),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs=</span>dtest<span class="sc">$</span>Salary</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>prev <span class="sc">|&gt;</span> <span class="fu">summarize_at</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="sc">~</span>(<span class="fu">mean</span>((.<span class="sc">-</span>obs)<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">|&gt;</span> <span class="fu">sqrt</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       lin      pcr      pls
1 334.8819 348.3943 342.7771</code></pre>
</div>
</div></li>
<li><p>Comparer ces méthodes à l’aide d’une validation croisée 10 blocs.</p>
<div class="corR">
<p><strong>Attention</strong> il ne s’agit pas ici de sélectionner les nombres de composantes par validation croisée. On veut comparer :</p>
<ul>
<li><p>l’algorithme <strong>PCR</strong> qui sélectionne le nombre de composantes par validation croisée à</p></li>
<li><p>l’algorithme <strong>PLS</strong> qui sélectionne le nombre de composantes par validation croisée.</p></li>
</ul>
<p>On définit d’abord les 10 blocs pour la validation croisée :</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>bloc <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="fu">nrow</span>(Hitters),<span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(bloc)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>bloc
 1  2  3  4  5  6  7  8  9 10 
19 22 31 29 28 39 19 26 25 25 </code></pre>
</div>
</div>
<div class="corR">
<p>Puis on fait la validation croisée (en sélectionnant le nombre de composantes par validation croisée) à chaque étape :</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4321</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>prev <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span><span class="fu">nrow</span>(Hitters),<span class="at">ncol=</span><span class="dv">3</span>))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(prev) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lin"</span>,<span class="st">"PCR"</span>,<span class="st">"PLS"</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  print(k)</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  ind.test <span class="ot">&lt;-</span> bloc<span class="sc">==</span>k</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  dapp <span class="ot">&lt;-</span> Hitters[<span class="sc">!</span>ind.test,]</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  dtest <span class="ot">&lt;-</span> Hitters[ind.test,]</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  choix.pcr <span class="ot">&lt;-</span> <span class="fu">pcr</span>(Salary<span class="sc">~</span>.,<span class="at">data=</span>dapp,<span class="at">validation=</span><span class="st">"CV"</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  ncomp.pcr <span class="ot">&lt;-</span> <span class="fu">which.min</span>(choix.pcr<span class="sc">$</span>validation<span class="sc">$</span>PRESS)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  choix.pls <span class="ot">&lt;-</span> <span class="fu">plsr</span>(Salary<span class="sc">~</span>.,<span class="at">data=</span>dapp,<span class="at">validation=</span><span class="st">"CV"</span>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  ncomp.pls <span class="ot">&lt;-</span> <span class="fu">which.min</span>(choix.pls<span class="sc">$</span>validation<span class="sc">$</span>PRESS)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  mod.lin <span class="ot">&lt;-</span> <span class="fu">lm</span>(Salary<span class="sc">~</span>.,<span class="at">data=</span>dapp)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  prev[ind.test,] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lin=</span><span class="fu">predict</span>(mod.lin,<span class="at">newdata=</span>dtest),</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">PCR=</span><span class="fu">as.vector</span>(<span class="fu">predict</span>(choix.pcr,<span class="at">newdata =</span> dtest,<span class="at">ncomp=</span>ncomp.pcr)),</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">PLS=</span><span class="fu">as.vector</span>(<span class="fu">predict</span>(choix.pls,<span class="at">newdata =</span> dtest,<span class="at">ncomp=</span>ncomp.pls)))</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>prev <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">obs=</span>Hitters<span class="sc">$</span>Salary) <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_at</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="sc">~</span>(<span class="fu">mean</span>((.<span class="sc">-</span>obs)<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">|&gt;</span> <span class="fu">sqrt</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       lin      PCR      PLS
1 340.0631 343.8019 350.6712</code></pre>
</div>
</div>
<div class="corR">
<p>On compare à un modèle qui prédit toujours la moyenne :</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(Hitters<span class="sc">$</span>Salary) <span class="sc">|&gt;</span> <span class="fu">sqrt</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 451.1187</code></pre>
</div>
</div>
<div class="corR">
<p>On peut retenter l’analyse en considérant toutes les interactions d’ordre 2 :</p>
</div>
<div class="cell" data-teacher="true" data-hash="02-reg-comp_cache/html/CV-Hitters_96da6fb7614295bc91ba3a063e1fd135">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">54321</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>prev1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span><span class="fu">nrow</span>(Hitters),<span class="at">ncol=</span><span class="dv">3</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(prev1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lin"</span>,<span class="st">"PCR"</span>,<span class="st">"PLS"</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  print(k)</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  ind.test <span class="ot">&lt;-</span> bloc<span class="sc">==</span>k</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  dapp <span class="ot">&lt;-</span> Hitters[<span class="sc">!</span>ind.test,]</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  dtest <span class="ot">&lt;-</span> Hitters[ind.test,]</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  choix.pcr <span class="ot">&lt;-</span> <span class="fu">pcr</span>(Salary<span class="sc">~</span>.<span class="sc">^</span><span class="dv">2</span>,<span class="at">data=</span>dapp,<span class="at">validation=</span><span class="st">"CV"</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  ncomp.pcr <span class="ot">&lt;-</span> <span class="fu">which.min</span>(choix.pcr<span class="sc">$</span>validation<span class="sc">$</span>PRESS)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  choix.pls <span class="ot">&lt;-</span> <span class="fu">plsr</span>(Salary<span class="sc">~</span>.<span class="sc">^</span><span class="dv">2</span>,<span class="at">data=</span>dapp,<span class="at">validation=</span><span class="st">"CV"</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  ncomp.pls <span class="ot">&lt;-</span> <span class="fu">which.min</span>(choix.pls<span class="sc">$</span>validation<span class="sc">$</span>PRESS)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  mod.lin <span class="ot">&lt;-</span> <span class="fu">lm</span>(Salary<span class="sc">~</span>.<span class="sc">^</span><span class="dv">2</span>,<span class="at">data=</span>dapp)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  prev1[ind.test,] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lin=</span><span class="fu">predict</span>(mod.lin,<span class="at">newdata=</span>dtest),</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">PCR=</span><span class="fu">as.vector</span>(<span class="fu">predict</span>(choix.pcr,<span class="at">newdata =</span> dtest,<span class="at">ncomp=</span>ncomp.pcr)),</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">PLS=</span><span class="fu">as.vector</span>(<span class="fu">predict</span>(choix.pls,<span class="at">newdata =</span> dtest,<span class="at">ncomp=</span>ncomp.pls))</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="corR">
<p>On obtient les performances suivantes :</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>prev1 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">obs=</span>Hitters<span class="sc">$</span>Salary) <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_at</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="sc">~</span>(<span class="fu">mean</span>((.<span class="sc">-</span>obs)<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">|&gt;</span> <span class="fu">sqrt</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       lin      PCR      PLS
1 1494.847 330.0474 349.1116</code></pre>
</div>
</div>
<div class="corR">
<p>On mesure bien l’intérêt de réduire la dimension dans ce nouveau contexte.</p>
</div></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./01-intro-grande-dim.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Les problèmes de la grande dimension</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03-ridge-lasso.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Régressions pénalisées (ou sous contraintes)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>